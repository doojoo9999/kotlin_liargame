# Nemonemo Platform – Test Plan

## 1. 목표
- 로그인/인증, 퍼즐 생성/검증, 게임 플레이, 추천 시스템에 대해 **100% 코드 커버리지** 확보.
- 모든 도메인(퍼즐, 플레이, 랭킹, 도전과제, 커뮤니티, 멀티플레이, 관리자, 배치)의 정상/예외/경계 시나리오 검증.
- 프런트엔드 주요 사용자 경로에 대해 Playwright E2E 테스트 작성.
- 부하·보안 테스트 수행 및 리포트 확보.

## 2. 테스트 범주

### 2.1 단위 테스트
| 영역 | 주요 대상 | 도구 | 커버리지 목표 |
|------|-----------|------|----------------|
| 인증/세션 | 로그인 서비스, 세션 관리자, RateLimiter | JUnit + MockK | 100% (핵심) |
| 퍼즐 | 업로드 검증, 난이도 산정, 유일해 검증, 태깅 | JUnit + MockK | 100% (핵심) |
| 플레이 | 자동저장, 정답 검증, 점수 계산, Undo/Redo | JUnit + MockK | 100% (핵심) |
| 추천 | 일일 추천, 개인화 추천, 캐시 전략 | JUnit | 100% (핵심) |
| 랭킹 | 점수 업데이트, 페이징, 캐시 | JUnit | 90% |
| 도전과제/시즌 | 조건 계산, 보상 지급 | JUnit | 90% |
| 커뮤니티 | 댓글 CRUD, 신고, 필터링 | JUnit | 90% |
| 멀티플레이 | 룸 상태, 진행 로직, 점수 배분 | JUnit | 90% |
| 관리자/배치 | 검수 프로세스, 스케줄러 | JUnit | 90% |

### 2.2 통합 테스트
- SpringBootTest + Testcontainers(PostgreSQL, Redis).
- API별 happy-path, 권한, 예외, 입력 검증, 트랜잭션 롤백 시나리오.
- 핵심 경로(인증, 퍼즐 업로드→검수→플레이→제출→랭킹) 전체 커버.
- 배치/스케줄러 동작 검증(일일 추천, 시즌 종료 등).
- 퍼즐 업로드 파이프라인 4가지 응답(201/409/400/422) 및 메타데이터 저장 경로 통합 테스트 (`NemonemoPuzzleV2ControllerTest`).

### 2.3 E2E/시나리오 테스트 (Playwright)
| 시나리오 | 설명 |
|----------|------|
| 게스트 플레이 | 홈 접속 → 추천 퍼즐 선택 → 자동 저장 → 제출 → 랭킹 확인 |
| 로그인/세션 | 로그인 → 퍼즐 업로드 → 관리자 검수 → 플레이 → 로그아웃 |
| 커뮤니티 | 퍼즐 상세 → 댓글 작성 → 신고 → 관리자 처리 |
| 멀티플레이 | 룸 생성 → 사용자 2명 참여 → 실시간 진행 → 결과 확인 |
| 도전과제/시즌 | 미션 달성 → 보상 수령 → 시즌 패스 티어 업 |

Playwright 테스트는 DEV 환경에서 실행, CI에 통합.

### 2.4 부하 테스트
- **Load 사양**: 자동 저장 API, 정답 제출, 멀티플레이 WebSocket, 랭킹 조회.
- 도구: k6 or Gatling.
- 결과: TPS/Latency/에러 비율, 임계값, 확장 계획 문서화.

### 2.5 보안 테스트
- 입력 검증(퍼즐 업로드, 댓글, WebSocket), 파일 업로드 검사.
- CSRF/XSS/SQL Injection 테스트.
- 세션 탈취/재사용 시나리오 검증.
- Open Redirect, Rate Limit 우회 검사.

### 2.6 회귀 테스트
- 기능 추가 시 Regression Suite 실행.
- 자동화: Gradle task로 단위+통합+Playwright 한 번에 실행.

## 3. 환경
| 환경 | 목적 | 구성 |
|------|------|------|
| Local | 개발, 빠른 테스트 | H2/Postgres Testcontainers, Mock Redis |
| Dev/Staging | 통합 테스트, E2E | Postgres/Redis 실제 버전, SSL 설정, 샘플 데이터 |
| Prod | 운영 | 실 DB/Redis, SSL, 로그 수집 |

## 4. 프로세스
1. 기능 설계 시 테스트 전략(시나리오, 예외)을 문서화.
2. 코드 작성 전에 테스트 스켈레톤 작성(TDD 지향).
3. CI: PR마다 단위/통합 테스트 + lint + build 실행.
4. 플레이어블 변경 시 Playwright E2E 자동 실행.
5. 부하/보안 테스트는 릴리스 전 수행, 결과를 문서에 첨부.
6. 배포 전 최종 회귀 테스트 및 체크리스트 검토.

## 5. 산출물
- 테스트 코드 (단위/통합/E2E).
- 테스팅 리포트 (커버리지, 부하, 보안).
- 테스트 데이터/Fixture 정리.
- 회귀 테스트 체크리스트.
