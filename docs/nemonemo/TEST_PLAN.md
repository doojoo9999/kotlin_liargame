## 13) 테스트(코드/시나리오)

### 백엔드 테스트

#### 유닛 테스트 (JUnit5)
- **솔버 알고리즘**:
    - 단일해 퍼즐 (10×10, 20×20, 30×30)
    - 복수해 퍼즐 (감지 정확도)
    - 무해결 퍼즐 (조기 탈출)
    - 성능: 25×25 퍼즐 5초 이내, 30×30 퍼즐 30초 이내

- **점수 계산**:
    - 다양한 시나리오 (완벽 클리어, 실수, 힌트 사용)
    - 콤보 보너스 누적
    - 모드별 점수 차이

- **난이도 산정**:
    - 알려진 난이도 퍼즐로 회귀 테스트
    - 경계값 테스트 (최소/최대 난이도)

- **텍스트성 태깅**:
    - 벤치마크 데이터셋 (50개)
    - 정확도 목표: Precision/Recall 0.90 이상
    - False Positive/Negative 분석

#### 통합 테스트 (Testcontainers)
- **PostgreSQL**:
    - 복잡한 쿼리 (필터, 정렬, 조인)
    - 트랜잭션 격리 수준
    - 파티셔닝 동작

- **Redis**:
    - 캐시 히트/미스
    - Pub/Sub 메시지 전달
    - Sorted Set 리더보드

- **WireMock**:
    - 외부 API 모킹 (OCR, 이미지 처리)
    - 타임아웃/재시도 로직

#### 보안 테스트
- **토큰 위변조**:
    - 서명 무효화
    - 만료 시간 조작
    - 권한 상승 시도

- **제출 무결성**:
    - started_at 앞당김/지연
    - 이중 제출 (Idempotency)
    - 정답 데이터 변조

- **레이트 리밋**:
    - 임계값 초과 시 429 응답
    - IP/subject_key 별도 제한

### 프론트엔드 테스트

#### 컴포넌트 테스트 (Vitest + Testing Library)
- **게임 캔버스**:
    - 셀 클릭/드래그 입력
    - Undo/Redo 동작
    - 줌/팬 기능
    - 행/열 헤더 스크롤 동기화

- **에디터**:
    - 그리드 편집
    - 대칭/회전 도구
    - 힌트 생성 검증

- **폼**:
    - 유효성 검사 (Zod)
    - 에러 메시지 표시
    - 제출 Optimistic Update

#### E2E 테스트 (Playwright)

**시나리오 1: 게스트 플레이 풀 플로우**
1. 홈 접속 → 게스트 `anon_id` 자동 발급
2. 닉네임 설정
3. "오늘의 추천" 퍼즐 선택
4. 플레이: 셀 채우기, Undo, X 표시
5. 완성 및 제출
6. 리더보드에 내 기록 표시 확인

**시나리오 2: 퍼즐 업로드 및 OFFICIAL 승격**
1. 로그인
2. 에디터에서 10×10 퍼즐 작성
3. ASCII 아트 스타일 → 태깅만 되고 반려 X
4. 테스트 플레이 통과
5. 업로드 → 유일해 검증 통과
6. 퍼즐 게시
7. (시뮬레이션) 100명 플레이, 70% 추천
8. OFFICIAL 자동 승격 확인

**시나리오 3: 멀티플레이어 대결**
1. 2개 브라우저 탭으로 로그인
2. 플레이어1: 대결 모드 방 생성
3. 플레이어2: 방 참가
4. 모두 준비 완료
5. 게임 시작
6. 플레이어1 빠르게 완성
7. 플레이어2 완성
8. 결과 화면에 순위 및 점수 표시

**시나리오 4: 자정 추천 갱신**
1. 서버 시간을 23:59로 설정
2. 현재 "오늘의 추천" 확인
3. 시간을 00:01로 변경
4. 배치 실행 대기 (또는 수동 트리거)
5. 새로운 추천 목록 로드 확인
6. 캐시 ETag 변경 확인

**시나리오 5: 도전 과제 완료**
1. 활성 일일 미션 확인 ("5×5 퍼즐 3개 완료")
2. 5×5 퍼즐 1개 완성 → 진행률 1/3
3. 5×5 퍼즐 2개 완성 → 진행률 2/3
4. 5×5 퍼즐 3개 완성 → 미션 완료 팝업
5. 보상 수령

### 성능 테스트
- **부하 테스트** (JMeter/Gatling):
    - 동시 사용자 1000명
    - 피크 시간대 시뮬레이션
    - API 응답 시간 P95 < 200ms

- **스트레스 테스트**:
    - 멀티플레이어 방 100개 동시 진행
    - WebSocket 메시지 처리량

- **프론트엔드 성능**:
    - Lighthouse 점수 (Performance 90+)
    - 50×50 퍼즐 60fps 유지
    - 초기 로드 시간 < 2초

## 14) 문서/산출물(리포 포함)

### `/README.md`
- 프로젝트 개요
- 기술 스택
- 로컬 실행 가이드 (Docker Compose 포함)
- 환경변수 설명
- 아키텍처 다이어그램 링크
- 스크린샷/데모 영상

### `/docs/`
- `openapi.yaml` - API 전체 스펙
- `architecture.md` - Mermaid 다이어그램 (6개)
- `database-schema.md` - ERD, DDL
- `adr/` - Architecture Decision Records
    - `001-tech-stack.md`
    - `002-guest-authentication.md`
    - `003-multiplayer-architecture.md`
    - `004-text-detection-policy.md`
- `api-examples.http` - REST Client 스니펫
- `deployment.md` - 배포 가이드
- `testing-strategy.md` - 테스트 전략

### ADR 예시
```markdown
# ADR-004: 텍스트성 퍼즐 허용 정책

## Status
Accepted

## Context
기존 사이트는 문자/숫자 퍼즐을 제한했으나, 이는 표현의 자유를 과도하게 제약함.

## Decision
- 모든 픽셀 아트(CLI/ASCII 포함) 허용
- 텍스트성 추정은 태깅으로만 사용 (반려 근거 X)
- 검색/추천 가중치 조정용

## Consequences
- 다양한 창작물 수용
- 검색 정확도 향상
- 태깅 알고리즘 유지보수 필요
```

### 시드 데이터
`/src/main/resources/db/seed/`
- `puzzles.sql` - 10개 샘플 퍼즐
    - 단일해 (8개)
    - 복수해 (1개, 반려용)
    - 무해결 (1개, 반려용)
- `users.sql` - 테스트 계정 (guest, user, author, admin)
- `achievements.sql` - 업적 정의